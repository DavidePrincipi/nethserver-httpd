
#
# 10directory_begin -- basic ibay directory setup
#
<Directory {$DocumentRoot}>
    Options None
    Options +Indexes
    Options +Includes
    <RequireAll>
{
	if($Access eq 'private') {
            use esmith::NetworksDB; 
            my $networksDb = esmith::NetworksDB->open_ro() || return '';
            my $localNetworks = join ' ', map {
                my $u = $_;
                $u =~ s:/255\.255\.255\.255::g;
                $u;
              } $networksDb->local_access_spec;
            my $PrivateAllow = $localNetworks || '';
	    my $access = join(" \\\n        ", split(' ', $PrivateAllow));
	    $OUT = "      Require ip $access\n";
	} else {
	    $OUT = "      Require all granted\n";
	}

	if($PasswordStatus eq 'enabled') {
	    my $authName = $Description || $Name;
	    $OUT .= <<PASSWORD
      AuthType Basic
      AuthName "$authName"
      AuthUserFile conf/basic.htpasswd
      Require user $VhostName
PASSWORD
	}

     $OUT;
}
    </RequireAll>




